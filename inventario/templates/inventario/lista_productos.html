{% extends 'inventario/base.html' %} {% load humanize %} {% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="text-primary">Lista de Productos</h2>
  <a href="{% url 'crear_producto' %}" class="btn btn-success">
    <i class="bi bi-plus-circle"></i> Nuevo producto
  </a>
</div>

<table class="table table-hover table-bordered align-middle">
  <thead class="text-center">
    <tr>
      <th>Nombre</th>
      <th>Categoría</th>
      <th>Proveedor</th>
      <th>Descripción</th>
      <th>Precio</th>
      <th>Fecha de Registro</th>
      <th>Stock</th>
      <th>Estado</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for producto in productos %}
    <tr>
      <td>{{ producto.nombre }}</td>
      <td>{{ producto.categoria }}</td>
      <td>{{ producto.proveedor }}</td>
      <td>{{ producto.descripcion }}</td>
      <td>${{ producto.precio|intcomma }}</td>
      <td>{{ producto.fecha_registro|date:"d/m/Y H:i" }}</td>
      <td>{{ producto.cantidad }}</td>
      <td>
        {% if producto.estado == 'disponible' %}
        <span class="badge bg-success">Disponible</span>
        {% elif producto.estado == 'fuera_stock' %}
        <span class="badge bg-warning text-dark">Fuera de stock</span>
        {% else %}
        <span class="badge bg-secondary">Inactivo</span>
        {% endif %}
      </td>
      <td class="text-center">
        <a
          href="{% url 'editar_producto' producto.id %}"
          class="btn btn-warning btn-sm"
        >
          <i class="bi bi-pencil-square"></i> Editar
        </a>
        <form
          action="{% url 'eliminar_producto' producto.id %}"
          method="post"
          style="display: inline"
        >
          {% csrf_token %} {% if producto.estado == 'inactivo' %}
          <button type="submit" class="btn btn-success btn-sm btn-toggle">
            <i class="bi bi-arrow-repeat"></i> Habilitar
          </button>
          {% else %}
          <button type="submit" class="btn btn-danger btn-sm btn-toggle">
            <i class="bi bi-slash-circle"></i> Deshabilitar
          </button>
          {% endif %}
        </form>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="6" class="text-center text-muted">
        No hay productos registrados.
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const buttons = document.querySelectorAll(".btn-toggle");
  buttons.forEach(btn => {
    btn.addEventListener("click", function(e) {
      e.preventDefault();
      const form = this.closest("form");
      const action = this.classList.contains("btn-danger") ? "deshabilitar" : "habilitar";
      const icon = this.classList.contains("btn-danger") ? "warning" : "question";
      const color = this.classList.contains("btn-danger") ? "#dc3545" : "#198754";

      Swal.fire({
        title: `¿Deseas ${action} este producto?`,
        text: `El producto será marcado como ${action === 'deshabilitar' ? 'inactivo' : 'disponible'}.`,
        icon: icon,
        showCancelButton: true,
        confirmButtonColor: color,
        cancelButtonColor: "#6c757d",
        confirmButtonText: `Sí, ${action}`,
        cancelButtonText: "Cancelar"
      }).then(result => {
        if (result.isConfirmed) {
          form.submit();
        }
      });
    });
  });
});
</script>
{% endblock %}
